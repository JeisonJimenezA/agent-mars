# MAIN SCRIPT IMPLEMENTATION (main.py)

## CRITICAL RULES (READ FIRST - VIOLATIONS CAUSE CRASHES)

### 1. Dataclass Mutable Defaults
```python
# WRONG: layers: List[int] = []
# CORRECT: layers: List[int] = field(default_factory=list)
```

### 2. Environment Constraints
- **NO EMOJIS**: ASCII only (Windows crashes on emoji)
- **NO PARQUET**: Use `.to_csv()` only
- **ENCODING**: Always use `encoding='utf-8'`

### 3. API Compatibility
- **LightGBM**: Use `callbacks=[lgb.early_stopping(100)]`
- **y_train**: Must be 1D integer array, NOT one-hot

### 4. Code Order (CRITICAL)
```python
# WRONG:
class_weights = compute_weights(y=np.zeros(10))  # Dummy data!
X_train, y_train = load_data()

# CORRECT:
X_train, y_train = load_data()  # Load FIRST
class_weights = compute_weights(y=y_train)  # Then compute
```

---

## OUTPUT FORMAT

Provide COMPLETE working code in a single ```python block:

```python
# main.py
# Your implementation here
```

The script must be executable with: `python main.py`

---

## YOUR TASK

Create `main.py` - the orchestration script that:
1. Loads and processes data
2. Trains the model
3. Validates performance
4. Generates submission file

---

## REQUIRED OUTPUT

The script MUST print:
```
Final Validation Metric: <value>
```
Without this line, the solution is considered invalid.

---

## CONTEXT

### Problem Description
{problem_description}

### EDA Report
{eda_report}

### Solution Approach
{idea}

### Data Locations
- Training: `./train.csv`
- Test: `./test.csv`
- Metadata: `./metadata/`
- Submission output: `./submission/submission.csv`

---

## AVAILABLE MODULES (import from these)

{library_files}

---

## IMPLEMENTATION REQUIREMENTS

1. **Import modules**: Use the modules above, don't reimplement
2. **Fast training**: Limit samples and epochs for quick baseline
3. **Caching**: Call data functions with `load_cached_data=True`
4. **GPU support**: Auto-detect and use GPU if available
5. **Validation**: Load hold-out set from `./metadata/` directory
6. **Failure analysis**: Print error correlation with input features
7. **Submission**: Save to `./submission/submission.csv` matching sample format

### Performance Optimization
- Use evaluation mode for inference
- Disable gradients during inference (`torch.no_grad()`)
- Set appropriate batch sizes to avoid OOM

---

Now implement the complete `main.py` script:
